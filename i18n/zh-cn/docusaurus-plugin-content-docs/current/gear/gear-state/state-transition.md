---
sidebar_position: 2
sidebar_label: 'State transition'
---

# 状态转移

每个系统都遵循系统状态演变所依据的规则。 当网络处理新的输入数据时，状态会根据状态转换规则前进。 这些输入数据被包装在被称为交易的细小信息中。

Gear 节点维护和同步一个交易池，其中包含所有新交易。当任何节点（无论是否为验证者）收到一个交易时，该节点会将这个交传播给所有连接的节点。关于交易池如何运作的更高级内容，请参考 [Substrate 文档](https://substrate.dev/docs/en/knowledgebase/learn-substrate/tx-pool) 。 链接替换为 https://docs.substrate.io/v3/concepts/tx-pool/

当 Gear 验证节点生成新块时，池中的一些（或所有）交易将合并到一个区块中，网络将通过该块进行状态转换。在生成下一个块之前，上一个块中未打包的交易将保留在池子中，直到下一个区块产生。

Gear 支持以下类型的交易：

1. 创建程序用户上传新程序（智能合约）
2. 发送消息（程序或用户填充消息队列）
3. 退出消息队列验证者（块生产者）退出多条消息队列，运行相关程序
4. 余额交易（Gear 引擎执行用户—>程序验证者—>余额交易）

消息处理是在区块构建/导入时间的保留空间内进行的。它保证消息处理将在每个块中执行，并且至少以当前实例设置确定的某种特定速率执行。（没懂）

### 创建程序

Gear 网络的指定机构（或公共实施的任何用户）可以向国家提出保存的新方案。对于公共网络，还提供了一个与程序相关的余额。这个新的余额然后构成初始余额（存在的存款）。（没懂）

### 发送消息

终端用户与程序进行互动，因此，向 Gear 网络发送消息。发送到 Gear 网络的消息填满了全局消息队列。这个队列可以被看作是一个运行时间驱动的交易队列，但它保证任何被接受的消息最终都会被处理。 将消息放入队列不是免费的，因此可以保证发送消息。

### 消息出列

当轮到验证者产生下一个区块时，验证者可以选择让哪些消息出列。它消除了每个特定验证器维护完整内存状态的需要。 出列仅发生在每个块的末尾。 在出队期间，可以生成新消息。它们也可以在这个阶段被处理，但也可以留在队列中等待下一个块（和另一个验证器）。（不好理解）

### 余额交易

常规余额交易是在 Substrate 的 Balance 模块中进行的。

### 消息、区块和事件的生命周期

下图说明了 Gear 的永恒的生命周期。正如 actor 模型的通信所规定的，除了消息可以共享，再没有任何东西是可以共享的了。以 "系统" 为目的地的消息最终会出现在事件日志中，以便在用户空间进行检查。

![alt text](/assets/mq.jpg)
